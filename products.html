<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NégoSud</title>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/js/bootstrap.bundle.min.js'
        integrity='sha512-i9cEfJwUwViEPFKdC1enz4ZRGBj8YQo6QByFTF92YXHi7waCqyexvRD75S5NVTsSiTv7rKWqG9Y5eFxmRsOn0A=='
        crossorigin='anonymous'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.js'
        integrity='sha512-nO7wgHUoWPYGCNriyGzcFwPSF+bPDOR+NvtOYy2wMcWkrnCNPKBcFEkU80XIN14UVja0Gdnff9EmydyLlOL7mQ=='
        crossorigin='anonymous'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/noty/3.1.4/noty.js'
        integrity='sha512-mgZL3SZ/vIooDg2mU2amX6NysMlthFl/jDbscSRgF/k3zmICLe6muAs7YbITZ+61FeUoo1plofYAocoR5Sa1rQ=='
        crossorigin='anonymous'></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.13.0/jquery-ui.min.js"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.18/js/bootstrap-select.js'
        integrity='sha512-t2sE4D8vBHZoytr423dbCPmX8MUKM9bNiVKGOMpqFYEsV8/GilxvresTtCsv9RDzqGMcizOd7EuXssJUtaGZLg=='
        crossorigin='anonymous'></script>
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/css/bootstrap.css'
        integrity='sha512-bR79Bg78Wmn33N5nvkEyg66hNg+xF/Q8NA8YABbj+4sBngYhv9P8eum19hdjYcY7vXk/vRkhM3v/ZndtgEXRWw=='
        crossorigin='anonymous' />
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.css'
        integrity='sha512-+ouAqATs1y4kpPMCHfKHVJwf308zo+tC9dlEYK9rKe7kiP35NiP+Oi35rCFnc16zdvk9aBkDUtEO3tIPl0xN5w=='
        crossorigin='anonymous' />
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/noty/3.1.4/noty.css'
        integrity='sha512-NXUhxhkDgZYOMjaIgd89zF2w51Mub53Ru3zCNp5LTlEzMbNNAjTjDbpURYGS5Mop2cU4b7re1nOIucsVlrx9fA=='
        crossorigin='anonymous' />
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.13.0/themes/smoothness/jquery-ui.css">
    <link rel='stylesheet'
        href='https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.18/css/bootstrap-select.css'
        integrity='sha512-03p8fFZpOREY+YEQKSxxretkFih/D3AVX5Uw16CAaJRg14x9WOF18ZGYUnEqIpIqjxxgLlKgIB2kKIjiOD6++w=='
        crossorigin='anonymous' />
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- Bootstrap JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

    <script src="//code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="//code.jquery.com/ui/1.13.1/jquery-ui.min.js"></script>
    <style>
        @media only screen and (max-width: 1200px) {
            li:has(*[name="product-description"]) {
                flex: 40% !important;
            }
        }

        @media only screen and (max-width: 900px) {
            *[name="suggestion"] {
                width: 90% !important;
            }
        }

        @media only screen and (max-width: 650px) {
            li:has(*[name="product-description"]) {
                flex: 90% !important;
                margin: auto !important;
            }

            *[name="suggestion"] {
                width: 100% !important;
            }
        }

        .h-fit-content {
            height: fit-content;
        }
    </style>
    <script defer>
        const listImage = ["6K4A0477_533x.jpg", "6K4A0483_533x.jpg", "6K4A0496_533x.jpg", "6K4A0507_533x.jpg", "6K4A0516_533x.jpg", "6K4A0534_533x.jpg", "6K4A0570_533x.jpg", "6K4A0814_533x.jpg", "6K4A0478_533x.jpg", "6K4A0489_533x.jpg", "6K4A0504_533x.jpg", "6K4A0513_533x.jpg", "6K4A0522_533x.jpg", "6K4A0536_533x.jpg", "6K4A0572_533x.jpg", "6K4A0829_533x.jpg", "6K4A0480_533x.jpg", "6K4A0493_533x.jpg", "6K4A0506_533x.jpg", "6K4A0514_533x.jpg", "6K4A0530_533x.jpg", "6K4A0550_533x.jpg", "6K4A0578_533x.jpg", "AmberBottleShop_ToutBu_Bottleneck_Fort_SOL_byTiesBemelmans-64copy_533x.jpg"]

        async function getProducts() {
            await $.post('http://127.0.0.1/negosud/api/Produits.php', function (response) {
                const products = (response);
                $('div[name="products"]').html();
                products.forEach((product) => {
                    const item = `
                    <div class="col-lg-3 col-md-6 h-fit-content">
                        <div class="single-product position-relative">
                            <input type="hidden" name="region" value="${product.region}">
                            <input type="hidden" name="producer" value="${product.producteur}">
                            <input type="hidden" name="price" value="${product.prix_unitaire}">
                            <input type="hidden" name="id" value="${product.id}">
                            <img class="img-fluid w-100" src="http://127.0.0.1/negosud/wines/${product.imagePrincipal}" alt="">
                            <div class="position-absolute bottom-0 left-0 p-3 w-100 d-flex justify-content-between">
                                <div>
                                    <h5>${product.nomProduit}</h5>
                                    <div class="price">
                                        <h6>${product.prix_unitaire}€</h6>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    `;
                    $('div[name="products"]').append(item);
                })
            });
        }
        function getRegion() {
            const regionList = [...new Set($('input[name="region"]').map(function () { return $(this).val() }).get())];
            regionList.forEach((region) => {
                const item = `<div class="form-check"><input class="form-check-input" type="checkbox" id="${region}" name="region" value="${region}"><label for="${region}" class="form-check-label">${region}</label></div>`
                $('div[name="regionList"]').append(item);
            })
        }
        function getProducer() {
            const producerList = [...new Set($('input[name="producer"]').map(function () { return $(this).val() }).get())];
            producerList.forEach((producer) => {
                const item = `<div class="form-check"><input class="form-check-input" type="checkbox" id="${producer}" name="producer" value="${producer}"><label for="${producer}" class="form-check-label">${producer}</label></div>`
                $('div[name="producerList"]').append(item);
            })
        }
        function filter() {
            const regions = $('input[name="region"]:checked').map(function () { return $(this).val() }).get();
            const producers = $('input[name="producer"]:checked').map(function () { return $(this).val() }).get();
            $('.single-product').each(function () {
                $(this).parent().removeClass('d-none');

                const price = parseInt($(this).find('.price h6').html());

                const priceMin = $('#priceFilter .min').html()
                const priceMax = $('#priceFilter .max').html()




                const filters = [
                    (regions.length != 0 && !regions.includes($(this).find('input[name="region"]').attr('value'))),
                    (producers.length != 0 && !producers.includes($(this).find('input[name="producer"]').attr('value'))),
                    (price < priceMin || price > priceMax)
                ]


                if (!filters.every(element => element === false)) {
                    $(this).parent().addClass('d-none');
                }
            });
        }
        async function makePage() {
            await getProducts();
            await getRegion();
            await getProducer();
            $('#loader').addClass('d-none'); $('body').removeClass('overflow-hidden');
        }

        makePage();

        $(document).ready(() => {

            $('#search-producer').keyup(function () {
                const search = $(this).val().toLowerCase();

                $('#search-producer + div div').removeClass('d-none')

                $($('#search-producer + div div input').filter(function (index) { return !this.id.toLowerCase().match(search) })).parent().addClass('d-none')
            })

            $('#search-region').keyup(function () {
                const search = $(this).val().toLowerCase();

                $('#search-region + div div').removeClass('d-none')

                $($('#search-region + div div input').filter(function (index) { return !this.id.toLowerCase().match(search) })).parent().addClass('d-none')
            })

            $(document).on('click', 'input[name="region"]', () => { filter() });
            $(document).on('click', 'input[name="producer"]', () => { filter() });
            $(document).on('click', '.single-product', (e) => {
                e.preventDefault();
                const target = e.currentTarget;
                document.location = ('http://127.0.0.1/negosud/product?id=' + $(target).find('input[name="id"]').val());
            })
            const priceArray = $('.price h6').map(function () { return parseFloat($(this).html()) }).get();
            const minPrice = Math.floor(Math.min(...priceArray))
            const maxPrice = Math.ceil(Math.max(...priceArray))
            $("#slider-range").slider({
                range: true,
                min: minPrice,
                max: maxPrice,
                values: [
                    minPrice,
                    maxPrice],
                slide: function (event, ui) {
                    $('#priceFilter .min').html(ui.values[0]);
                    $('#priceFilter .max').html(ui.values[1]);
                    filter()
                }
            });
            $('#priceFilter .min').html(minPrice);
            $('#priceFilter .max').html(maxPrice);
        })
    </script>
</head>

<body class="overflow-hidden">
    <header style="z-index: 10" class="d-flex w-100 justify-content-evenly p-3 position-fixed">
        <img src="./banner.jpg" style="height: 5em" alt="">
        <nav>
            <ul style="list-style: none; display:flex;">
                <li>
                    <a href="http://127.0.0.1/negosud" class="p-3 nav-link">Home</a>
                </li>
                <li>
                    <a href="http://127.0.0.1/negosud/products" class="p-3 nav-link">Products</a>
                </li>
                <li>
                    <a href="#" class="p-3 nav-link">Contact</a>
                </li>
                <li>
                    <a href="#" class="p-3 nav-link">
                        <span style="border-right: 1px solid rgba(0, 0, 0, 0.466)"></span>
                    </a>
                </li>
                <li>
                    <a href="#" class="p-3 nav-link">
                        <i class="fa fa-shopping-cart" aria-hidden="true"></i>
                        <span class="badge badge-primary"></span>
                    </a>
                </li>
            </ul>
        </nav>
    </header>
    <header style="z-index: 10; opacity: 0;" class="d-flex w-100 justify-content-evenly p-3">
        <img src="./banner.jpg" style="height: 5em" alt="">
        <nav>
            <ul style="list-style: none; display:flex;">
                <li>
                    <a href="http://127.0.0.1/negosud" class="p-3 nav-link">Home</a>
                </li>
                <li>
                    <a href="http://127.0.0.1/negosud/products" class="p-3 nav-link">Products</a>
                </li>
                <li>
                    <a href="#" class="p-3 nav-link">Contact</a>
                </li>
                <li>
                    <a href="#" class="p-3 nav-link">
                        <span style="border-right: 1px solid rgba(0, 0, 0, 0.466)"></span>
                    </a>
                </li>
                <li>
                    <a href="#" class="p-3 nav-link">
                        <i class="fa fa-shopping-cart" aria-hidden="true"></i>
                        <span class="badge badge-primary"></span>
                    </a>
                </li>
            </ul>
        </nav>
    </header>
    <div id="loader" style="z-index: 1;"
        class="vw-100 vh-100 top-0 d-flex justify-content-center align-items-center position-absolute bg-white">
        <img src="http://127.0.0.1/negosud/d3f472b06590a25cb4372ff289d81711_w200.gif" alt="">
    </div>
    <section class="h-100 p-5 d-flex">
        <div class="col-2 position-relative">
            <div class="mx-auto position-fixed" style="width: 15%; height: 75vh; overflow-y: scroll;">
                <h3>Filters</h3>
                <p>
                    <a class="d-flex justify-content-between" data-toggle="collapse" href="#regionFilter" role="button">
                        <span>Region</span><i class="fa fa-angle-down" aria-hidden="true"></i>
                    </a>
                </p>
                <div class="collapse w-75 p-3" id="regionFilter">
                    <input type="text" id="search-region">
                    <div class="p-0" name="regionList"></div>
                </div>

                <p>
                    <a class="d-flex justify-content-between" data-toggle="collapse" href="#priceFilter" role="button">
                        <span>Price</span><i class="fa fa-angle-down" aria-hidden="true"></i>
                    </a>
                </p>
                <div class="collapse w-75 p-3" id="priceFilter">
                    <div class="d-flex justify-content-between">
                        <span>min</span>
                        <span>max</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span class="min"></span>
                        <span class="max"></span>
                    </div>
                    <div id="slider-range"></div>
                </div>

                <p>
                    <a class="d-flex justify-content-between" data-toggle="collapse" href="#producerFilter"
                        role="button">
                        <span>Producer</span><i class="fa fa-angle-down" aria-hidden="true"></i>
                    </a>
                </p>
                <div class="collapse w-75 p-3" id="producerFilter">
                    <input type="text" id="search-producer">
                    <div class="p-0" name="producerList"></div>
                </div>
            </div>
        </div>
        <div name="products" class="d-flex flex-wrap col-10"></div>
    </section>
</body>

</html>